{%- comment -%}
<!-- 
	Note:
	page.outside_preview must exist or else this will probably error.
-->
{%- endcomment -%}

{%- comment -%} <!-- miscellaneous stuff --> {%- endcomment -%}

{%- assign title_separator = site.title_separator | default: '-' | replace: '|', '&#124;' -%}
{%- assign author = page.author | default: page.authors[0] | default: site.author -%}
{%- assign author = site.data.authors[author] | default: author -%}

{%- comment -%} <!-- seo_title --> {%- endcomment -%}

{%- assign seo_title = "" -%}

{%- if page.title -%}
{%- if page.outside_preview.site_title -%}
{%- assign seo_title = page.title | append: " " | append: title_separator | append: " " | append: page.outside_preview.site_title -%}
{%- else -%}
{%- assign seo_title = page.title -%}
{%- endif -%}
{%- endif -%}

{%- if page.outside_preview.title -%}
{%- if page.outside_preview.site_title -%}
{%- assign seo_title = page.outside_preview.title | append: " " | append: title_separator | append: " " | append: page.outside_preview.site_title -%}
{%- else -%}
{%- assign seo_title = page.outside_preview.title -%}
{%- endif -%}
{%- endif -%}

{%- assign seo_title = seo_title | markdownify | strip_html | strip_newlines | escape_once -%}

<title>{{ seo_title }}</title>

{%- comment -%} <!-- seo_description --> {%- endcomment -%}

{%- assign seo_description = page.outside_preview.description -%}
{%- if seo_description -%}
{%- assign seo_description = seo_description | markdownify | strip_html | newline_to_br | strip_newlines | replace: '<br />', ' ' | escape_once | strip -%}
{%- endif -%}

{%- if seo_description -%}
<meta name="description" content="{{ seo_description }}">
<meta property="og:description" content="{{ seo_description }}">
{%- else -%}
<meta name="description" content="">
{%- endif -%}

{%- comment -%} <!-- canonical_url --> {%- endcomment -%}

{%- if page.canonical_url -%}
{%- assign canonical_url = page.canonical_url -%}
{%- else -%}
{%- assign canonical_url = page.url | replace: "index.html", "" | absolute_url -%}
{%- endif -%}

<meta property="og:url" content="{{ canonical_url }}">
<link rel="canonical" href="{{ canonical_url }}">

{%- comment -%} <!-- page_large_image + page_teaser_image --> {%- endcomment -%}

{%- assign page_large_image = page.header.og_image | default: page.header.overlay_image | default: page.header.image | absolute_url -%}
{%- assign page_large_image = page_large_image | escape -%}

{%- assign page_teaser_image = page.header.teaser | default: site.og_image | absolute_url -%}
{%- assign page_teaser_image = page_teaser_image | escape -%}

{%- if page_large_image -%}
<meta property="og:image" content="{{ page_large_image }}">
{%- elsif page_teaser_image -%}
<meta property="og:image" content="{{ page_teaser_image }}">
{%- endif -%}

{%- comment -%} <!-- author_twitter --> {%- endcomment -%}

{%- if author.twitter -%}
{%- assign author_twitter = author.twitter | replace: "@", "" -%}
{%- endif -%}

{%- if author_twitter -%}
<meta name="twitter:creator" content="@{{ author_twitter }}">
{%- endif -%}

{%- comment -%} <!-- complex twitter stuff --> {%- endcomment -%}

{%- if site.twitter.username -%}
<meta name="twitter:site" content="@{{ site.twitter.username | replace: "@", "" }}">
<meta name="twitter:title" content="{{ seo_title }}">
<meta name="twitter:description" content="{{ seo_description }}">
<meta name="twitter:url" content="{{ canonical_url }}">
{%- if page_large_image -%}
<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:image" content="{{ page_large_image }}">
{%- else -%}
<meta name="twitter:card" content="summary">
{%- if page_teaser_image -%}
<meta name="twitter:image" content="{{ page_teaser_image }}">
{%- endif -%}
{%- endif -%}
{%- endif -%}

{%- comment -%} <!-- end --> {%- endcomment -%}